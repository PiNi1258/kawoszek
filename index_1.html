<!DOCTYPE html>
<html lang="pl">
<head>
  <title>≈öled≈∫ Stany R√≥≈ºnych Kategorii</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Aplikacja do ≈õledzenia r√≥≈ºnych kategorii. Monitoruj swoje dzia≈Çania z naszƒÖ prostƒÖ aplikacjƒÖ.">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="≈öled≈∫ Kategorii">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
  <div class="container">
    <nav class="nav">
      <a class="nav-link active" href="#" id="homeLink" onclick="displaySection('homePage')">Strona g≈Ç√≥wna</a>
      <a class="nav-link" href="#" id="reportsLink" onclick="displaySection('reportsPage')">Raporty</a>
      <a class="nav-link" href="#" id="editLink" onclick="displaySection('editPage')">Edycja danych</a>
    </nav>
  </div>
</header>
<main class="container">
  <div id="homePage">
    <h2>Dodaj nowƒÖ sekcjƒô</h2>
    <input type="text" id="newSectionName" placeholder="Nazwa sekcji">
    <button onclick="addNewSection()">Dodaj</button>
    <div id="sectionsContainer"></div>
  </div>
  <div id="reportsPage" style="display: none;">
    <h2>Raporty</h2>
    <div id="chartsContainer"></div>
  </div>
  <div id="editPage" style="display: none;">
    <h2>Edycja danych</h2>
    <div id="editSectionsContainer"></div>
  </div>
</main>
<footer class="footer">
  <p>Made with ‚ù§Ô∏è by PiZi inspired by NiiX ü•∞</p>
</footer>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sectionsDataKey = 'sectionsData';
    const today = new Date().toISOString().split('T')[0];
    let charts = {};

    const loadSectionsData = () => JSON.parse(localStorage.getItem(sectionsDataKey)) || {};

    const saveSectionsData = (data) => localStorage.setItem(sectionsDataKey, JSON.stringify(data));

    const updateSectionCounts = (sectionName, countUpdate) => {
      const sectionsData = loadSectionsData();
      const history = sectionsData[sectionName].history || {};
      const count = sectionsData[sectionName].count || 0;

      sectionsData[sectionName].count = count + countUpdate;
      history[today] = (history[today] || 0) + countUpdate;
      sectionsData[sectionName].history = history;

      saveSectionsData(sectionsData);
      renderSections();
      renderCharts();
    }

    const renderSections = () => {
      const sectionsData = loadSectionsData();
      const sectionsContainer = document.getElementById('sectionsContainer');
      const editSectionsContainer = document.getElementById('editSectionsContainer');

      sectionsContainer.innerHTML = '';
      editSectionsContainer.innerHTML = '';

      for (const sectionName in sectionsData) {
        const sectionCount = sectionsData[sectionName].count || 0;
        sectionsContainer.innerHTML += `
                <section>
                    <h2>${sectionName}</h2>
                    <button onclick="updateSectionCounts('${sectionName}', 1)">Dodaj</button>
                    <div>Liczba: ${sectionCount}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Ilo≈õƒá</th>
                            </tr>
                        </thead>
                        <tbody>${renderSectionHistory(sectionsData[sectionName].history)}</tbody>
                    </table>
                </section>
            `;

        editSectionsContainer.innerHTML += `
                <section>
                    <h2>${sectionName}</h2>
                    <input type="date" id="${sectionName}_date" value="${today}">
                    <input type="number" id="${sectionName}_count" placeholder="Liczba">
                    <button onclick="editSectionHistory('${sectionName}')">Aktualizuj</button>
                    <button onclick="resetSectionHistory('${sectionName}')">Resetuj</button>
                </section>
            `;
      }
    }

    const renderSectionHistory = (history) => {
      return Object.entries(history || {}).sort(([dateA], [dateB]) => new Date(dateB) - new Date(dateA))
              .map(([date, count]) => `<tr><td>${date}</td><td>${count}</td></tr>`).join('');
    }

    const renderCharts = () => {
      const sectionsData = loadSectionsData();
      const chartsContainer = document.getElementById('chartsContainer');

      chartsContainer.innerHTML = '';

      for (const sectionName in sectionsData) {
        const history = sectionsData[sectionName].history || {};
        const canvasId = `chart_${sectionName}`;

        chartsContainer.innerHTML += `
                <div>
                    <h3>${sectionName}</h3>
                    <canvas id="${canvasId}" width="400" height="200"></canvas>
                </div>
            `;

        if (charts[canvasId]) {
          charts[canvasId].destroy();
        }

        const ctx = document.getElementById(canvasId).getContext('2d');
        charts[canvasId] = new Chart(ctx, {
          type: 'line',
          data: {
            labels: Object.keys(history),
            datasets: [{
              label: sectionName,
              data: Object.values(history),
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      }
    }

    window.updateSectionCounts = updateSectionCounts;
    window.renderSections = renderSections;
    window.renderCharts = renderCharts;

    window.addNewSection = () => {
      const newSectionName = document.getElementById('newSectionName').value;

      if (newSectionName) {
        const sectionsData = loadSectionsData();
        if (!sectionsData[newSectionName]) {
          sectionsData[newSectionName] = { count: 0, history: {} };
          saveSectionsData(sectionsData);
          renderSections();
        }
      }
    }

    window.editSectionHistory = (sectionName) => {
      const date = document.getElementById(`${sectionName}_date`).value;
      const newCount = parseInt(document.getElementById(`${sectionName}_count`).value);

      if (date && !isNaN(newCount)) {
        const sectionsData = loadSectionsData();
        const history = sectionsData[sectionName].history || {};
        history[date] = newCount;
        sectionsData[sectionName].history = history;
        saveSectionsData(sectionsData);
        renderSections();
        renderCharts();
      }
    }

    window.resetSectionHistory = (sectionName) => {
      const sectionsData = loadSectionsData();
      sectionsData[sectionName].count = 0;
      sectionsData[sectionName].history = {};
      saveSectionsData(sectionsData);
      renderSections();
      renderCharts();
    }

    window.displaySection = (sectionId) => {
      const sections = ['homePage', 'reportsPage', 'editPage'];

      sections.forEach(id => {
        document.getElementById(id).style.display = id === sectionId ? 'block' : 'none';
      });

      ['homeLink', 'reportsLink', 'editLink'].forEach(linkId => {
        document.getElementById(linkId).classList.toggle('active', linkId === `${sectionId}Link`);
      });

      if (sectionId === 'reportsPage') {
        renderCharts();
      }
    }

    renderSections();
    renderCharts();
  });
</script>
</body>
</html>
